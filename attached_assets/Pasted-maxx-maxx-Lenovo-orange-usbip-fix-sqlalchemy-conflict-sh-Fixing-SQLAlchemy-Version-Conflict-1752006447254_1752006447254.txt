maxx@maxx-Lenovo:~/orange-usbip$ ./fix_sqlalchemy_conflict.sh
=== Fixing SQLAlchemy Version Conflict ===
1. Removing user-installed SQLAlchemy packages...
2. Removing system packages that might conflict...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  colcon libavahi-gobject0 libavahi-ui-gtk3-0 libconfig9 libfreerdp2-2t64
  libgtk-vnc-2.0-0 libgvnc-1.0-0 libmicrohttpd12t64 libphodav-3.0-0
  libphodav-3.0-common libspice-client-glib-2.0-8 libspice-client-gtk-3.0-5
  libtgl-0.0.0.20160623-0t64 libusbredirhost1t64 libwinpr2-2t64 libxcomp3t64
  nxproxy python3-greenlet python3-netifaces rdesktop
  ros-jazzy-shared-queues-vendor spice-client-glib-usb-acl-helper vinagre
Use 'sudo apt autoremove' to remove them.
The following packages will be REMOVED:
  python3-flask-sqlalchemy python3-sqlalchemy python3-sqlalchemy-ext
0 upgraded, 0 newly installed, 3 to remove and 210 not upgraded.
After this operation, 6,667 kB disk space will be freed.
(Reading database ... 365484 files and directories currently installed.)
Removing python3-flask-sqlalchemy (3.0.3-1) ...
Removing python3-sqlalchemy-ext:amd64 (1.4.50+ds1-1build1) ...
Removing python3-sqlalchemy (1.4.50+ds1-1build1) ...
3. Reinstalling system packages...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  colcon libavahi-gobject0 libavahi-ui-gtk3-0 libconfig9 libfreerdp2-2t64
  libgtk-vnc-2.0-0 libgvnc-1.0-0 libmicrohttpd12t64 libphodav-3.0-0
  libphodav-3.0-common libspice-client-glib-2.0-8 libspice-client-gtk-3.0-5
  libtgl-0.0.0.20160623-0t64 libusbredirhost1t64 libwinpr2-2t64 libxcomp3t64
  nxproxy python3-netifaces rdesktop ros-jazzy-shared-queues-vendor
  spice-client-glib-usb-acl-helper vinagre
Use 'sudo apt autoremove' to remove them.
The following additional packages will be installed:
  python3-sqlalchemy-ext
Suggested packages:
  python-sqlalchemy-doc python3-fdb python3-pymssql python3-mysqldb
  python3-psycopg2 python3-asyncpg python3-aiosqlite
The following NEW packages will be installed:
  python3-flask-sqlalchemy python3-sqlalchemy python3-sqlalchemy-ext
0 upgraded, 3 newly installed, 0 to remove and 210 not upgraded.
Need to get 1,068 kB of archives.
After this operation, 6,667 kB of additional disk space will be used.
Get:1 http://ca.archive.ubuntu.com/ubuntu noble/main amd64 python3-sqlalchemy all 1.4.50+ds1-1build1 [1,020 kB]
Get:2 http://ca.archive.ubuntu.com/ubuntu noble/universe amd64 python3-flask-sqlalchemy all 3.0.3-1 [30.9 kB]
Get:3 http://ca.archive.ubuntu.com/ubuntu noble/main amd64 python3-sqlalchemy-ext amd64 1.4.50+ds1-1build1 [17.3 kB]
Fetched 1,068 kB in 1s (1,091 kB/s)               
Selecting previously unselected package python3-sqlalchemy.
(Reading database ... 365145 files and directories currently installed.)
Preparing to unpack .../python3-sqlalchemy_1.4.50+ds1-1build1_all.deb ...
Unpacking python3-sqlalchemy (1.4.50+ds1-1build1) ...
Selecting previously unselected package python3-flask-sqlalchemy.
Preparing to unpack .../python3-flask-sqlalchemy_3.0.3-1_all.deb ...
Unpacking python3-flask-sqlalchemy (3.0.3-1) ...
Selecting previously unselected package python3-sqlalchemy-ext:amd64.
Preparing to unpack .../python3-sqlalchemy-ext_1.4.50+ds1-1build1_amd64.deb ...
Unpacking python3-sqlalchemy-ext:amd64 (1.4.50+ds1-1build1) ...
Setting up python3-sqlalchemy (1.4.50+ds1-1build1) ...
Setting up python3-sqlalchemy-ext:amd64 (1.4.50+ds1-1build1) ...
Setting up python3-flask-sqlalchemy (3.0.3-1) ...
4. Checking Python paths...
Python paths:
  
  /opt/ros/jazzy/lib/python3.12/site-packages
  /usr/lib/python312.zip
  /usr/lib/python3.12
  /usr/lib/python3.12/lib-dynload
  /home/maxx/.local/lib/python3.12/site-packages
  /usr/local/lib/python3.12/dist-packages
  /usr/lib/python3/dist-packages
5. Testing import...
✓ SQLAlchemy version: 2.0.39
✓ SQLAlchemy location: /home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/__init__.py
✓ Flask-SQLAlchemy import successful
✗ App import failed: Class '<class 'models.User'>' already has a primary mapper defined. 
Traceback (most recent call last):
  File "<string>", line 18, in <module>
  File "/home/maxx/orange-usbip/app.py", line 142, in <module>
    from models import User, DeviceAlias, UsbPort, LogEntry, VirtualUsbDevice, VirtualUsbPort, VirtualUsbFile, TerminalCommand
  File "/home/maxx/orange-usbip/models.py", line 7, in <module>
    class User(UserMixin, db.Model):
  File "/usr/lib/python3/dist-packages/flask_sqlalchemy/model.py", line 100, in __init__
    super().__init__(name, bases, d, **kwargs)
  File "/usr/lib/python3/dist-packages/flask_sqlalchemy/model.py", line 120, in __init__
    super().__init__(name, bases, d, **kwargs)
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/decl_api.py", line 198, in __init__
    _as_declarative(reg, cls, dict_)
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py", line 244, in _as_declarative
    return _MapperConfig.setup_mapping(registry, cls, dict_, None, {})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py", line 325, in setup_mapping
    return _ClassScanMapperConfig(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py", line 518, in __init__
    super().__init__(registry, cls_, mapper_kw)
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/decl_base.py", line 341, in __init__
    instrumentation.register_class(
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/instrumentation.py", line 682, in register_class
    manager._update_state(
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/instrumentation.py", line 207, in _update_state
    registry._add_manager(self)
  File "/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy/orm/decl_api.py", line 1402, in _add_manager
    raise exc.ArgumentError(
sqlalchemy.exc.ArgumentError: Class '<class 'models.User'>' already has a primary mapper defined. 
✗ Import still failing
Checking for remaining conflicts...
/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy-2.0.39.dist-info
/home/maxx/.local/lib/python3.12/site-packages/sqlalchemy
/home/maxx/.local/lib/python3.12/site-packages/pgvector/sqlalchemy
=== Complete ===
